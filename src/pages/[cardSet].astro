---
import Layout from '../layouts/Layout.astro';
import FlashcardApp from '../components/flashcard/FlashcardApp.tsx';

export async function getStaticPaths() {
  // Load card sets to generate static paths
  try {
    const cardSetsResponse = await fetch(
      new URL(
        '/data/card_set.json',
        import.meta.env.SITE || 'http://localhost:4321'
      )
    );
    const cardSetsData = await cardSetsResponse.json();

    // Generate paths for each card set - cardSetsData is an array
    const paths = cardSetsData.map((cardSet: any) => ({
      params: { cardSet: cardSet.id },
      props: {
        cardSetId: cardSet.id,
        cardSetName: cardSet.name,
        cardSetDescription: cardSet.description,
      },
    }));

    return paths;
  } catch (error) {
    console.error('Error loading card sets for static paths:', error);
    return [];
  }
}

const { cardSet } = Astro.params;
const { cardSetId, cardSetName, cardSetDescription } = Astro.props;
---

<Layout title={`${cardSetName || cardSet} - Learn Chinese Flashcards`}>
  <FlashcardApp
    client:load
    preloadCardSet={cardSetId || cardSet}
    cardSetName={cardSetName}
    cardSetDescription={cardSetDescription}
  />
</Layout>
